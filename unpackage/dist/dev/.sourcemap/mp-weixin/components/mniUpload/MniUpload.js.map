{"version":3,"sources":["webpack:///D:/code/2.0app/components/mniUpload/MniUpload.vue?0465","webpack:///D:/code/2.0app/components/mniUpload/MniUpload.vue?99bc","webpack:///D:/code/2.0app/components/mniUpload/MniUpload.vue?05cc","webpack:///D:/code/2.0app/components/mniUpload/MniUpload.vue?5bcb","uni-app:///components/mniUpload/MniUpload.vue","webpack:///D:/code/2.0app/components/mniUpload/MniUpload.vue?e5f0"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":";;;;2DAAA,yTACIA,EADJ,mKASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,qCACZ,aAAAF,E;;;;2GCvBf,8mC;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G;;;;2DCRvB,ouBAA6qB,eAAG,G;;;;4OCmChrB,sCACA,2BACA,kBACA,oD,4iCACA,CACA,iBACA,OACA,SACA,YACA,QAFA,WAGA,WAGA,mCACA,sCACA,mCACA,aACA,YACA,QAFA,WAGA,OACA,gBACA,cAIA,eACA,YACA,QAFA,WAGA,OACA,6BACA,eACA,kBAIA,oCACA,qCACA,yCAEA,KAnCA,WAoCA,OACA,mBACA,aACA,aACA,eACA,cACA,eAGA,eACA,gDADA,CAEA,OAFA,WAGA,wDAEA,eALA,WAMA,6CAGA,SACA,OADA,SACA,GACA,WACA,aACA,wCACA,yCACA,oBACA,cACA,qBACA,KACA,QACA,kBAMA,YAjBA,SAiBA,GAEA,IADA,SACA,qCACA,4BACA,UAEA,gBACA,oCACA,UAGA,YA5BA,WA6BA,wDACA,kCACA,2CAFA,CAMA,yCACA,uBACA,cACA,OACA,8BACA,KAEA,eACA,QACA,wBACA,8BACA,oBACA,wCACA,2DAKA,IAJA,oBACA,qBACA,KACA,KACA,oBAEA,WACA,QACA,iCAOA,UACA,wBAGA,gCAKA,iBAzEA,SAyEA,oEACA,MACA,QACA,sCACA,GACA,aACA,0CACA,YACA,UACA,CACA,oCACA,EAKA,GACA,yCACA,SACA,aACA,iBACA,2CACA,QAIA,UAnGA,WAmGA,WAEA,2CACA,0DACA,kBACA,kBACA,sEAIA,QAnKA,WAoKA,kCACA,sBACA,mBACA,gCACA,UACA,YACA,OACA,QACA,OACA,qBACA,KACA,W,YAMA,8IAOA,WACA,aARA,gCASA,mDACA,aACA,YACA,kBAZA,kCAiBA,SAjBA,wBAkBA,KACA,kBAnBA,UAoBA,0CACA,aACA,YACA,kBAvBA,QA0BA,yBA1BA,QA4BA,KACA,6CACA,iEA9BA,QAgCA,iCAhCA,oGAmCA,oBACA,SACA,cACA,iBAEA,GADA,yBACA,MACA,2BACA,QACA,WACA,YACA,oBAIA,QACA,WACA,SACA,eAGA,4BACA,wEAEA,mBACA,aACA,+CAIA,+BAEA,U,SAEA,E,4EAAA,uGACA,eACA,GACA,4CACA,UACA,wBALA,SAOA,sEACA,iBACA,kCACA,6BACA,8EAXA,2C,iCAgBA,E,4EAAA,oGAEA,WAFA,6BAGA,KAHA,qFAIA,OAJA,SAKA,cACA,gBACA,QACA,eAEA,gBACA,YACA,sBACA,QARA,SAQA,GACA,sBACA,yBACA,kBACA,aACA,kCACA,6BACA,6EAIA,KAnBA,SAmBA,GACA,uCAzBA,0CAGA,eAHA,YAGA,KAHA,yCAGA,KAHA,eAGA,IAHA,0D,iCA6DA,E,4EAAA,wFAwCA,OAxCA,2C;;;;2DC7WA,oyCAAsvC,eAAG,G","file":"components/mniUpload/MniUpload.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./MniUpload.vue?vue&type=template&id=4103c6f8&scoped=true&\"\nvar renderjs\nimport script from \"./MniUpload.vue?vue&type=script&lang=js&\"\nexport * from \"./MniUpload.vue?vue&type=script&lang=js&\"\nimport style0 from \"./MniUpload.vue?vue&type=style&index=0&id=4103c6f8&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4103c6f8\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/mniUpload/MniUpload.vue\"\nexport default component.exports","export * from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./MniUpload.vue?vue&type=template&id=4103c6f8&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./MniUpload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./MniUpload.vue?vue&type=script&lang=js&\"","<template>\r\n\t<!-- 头像上传 -->\r\n\t<view v-if=\"uploadType == 'touxiang'\" class=\"userinfo-upload\" @click='chooseImags'>\r\n\t\t<view class=\"sunsin_picture_item\">\r\n\t\t\t<image :src=\"newUserImgPath || userImgPath\" class=\"sunsin_width\"  mode=\"aspectFill\" ref=\"uImage\" ></image>\r\n\t\t</view>\r\n\t</view>\r\n\t<!-- 通用上传 -->\r\n\t<view class=\"formElemets form-upimg\" v-else-if=\"!uploadType && element.visiabled\" :class=\"[element.readonly?'readonly':'']\">\r\n\t\t<label class=\"text\">\r\n\t\t\t{{ element.label }}\r\n\t\t\t<span v-if=\"element.requisite\" class=\"icon iconfont iconmust-fill2 requisite\"></span>\r\n\t\t</label>\r\n\t\t<view class=\"content\">\r\n\t\t<scroll-view scroll-x>\r\n\t\t\t<view class=\"sunsin_picture_list\">\r\n\t\t\t\t<view class='sunsin_picture_item sunsin_width' v-if=\"!(picNum!==-1 && picsArray.length>=picNum) && !element.readonly\">\r\n\t\t\t\t\t<view class=\"sunsin_add_image sunsin_width\" @click='chooseImags'></view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"sunsin_picture_item\"  v-for=\"(item,index) in picsArray\" :key=\"index\">\r\n\t\t\t\t\t<image :src=\"item.base64 || item.url\" class=\"sunsin_width\"  mode=\"aspectFill\"\r\n\t\t\t\t\t :data-src=\"item.url\"\r\n\t\t\t\t\t @click=\"previewImgs\"></image>\r\n\t\t\t\t\t<view class=\"del-image\" v-if=\"!element.readonly\" @click=\"delImg(index)\">×</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"sunsin_picture_item\"  v-for=\"nouploadIndex in noUploadNumber\" :key=\"'noimage-'+nouploadIndex\">\r\n\t\t\t\t\t<image src=\"../../static/images/svg/tail-spin.svg\" style=\"width: 25px; height: 25px;\" mode=\"aspectFill\" ></image>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t\t</view>\r\n\t</view>\n</template>\n\n<script>\r\n\timport {fileApi} from '@/common/request/api.js'\r\n\timport {UPLOAD_URLTOBASE64, dataURLToFile} from './upload.js'\r\n\timport { mapState, mapMutations } from 'vuex'\r\n\timport tailSpin from \"@/static/images/svg/tail-spin.svg\"\r\n\texport default {\r\n\t\tname:\"MniUpload\",\r\n\t\tprops:{\r\n\t\t\telement:{\r\n\t\t\t\ttype:Object,\r\n\t\t\t\tdefalut(){\r\n\t\t\t\t\treturn {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tbase64Url:{type:String,defalut:''},\r\n\t\t\trelationName:{type:String,defalut:''},//关联名称\r\n\t\t\tuploadNum:{type:Number,defalut:-1},//可选择的图片\r\n\t\t\timageConfig:{//图片参数\r\n\t\t\t\ttype:Object,\r\n\t\t\t\tdefalut(){\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tallImgsParam:{},\r\n\t\t\t\t\t\telement:{}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trequestConfig:{//图片接口参数\r\n\t\t\t\ttype:Object,\r\n\t\t\t\tdefalut(){\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tsubmitUrl:'file/uploadFiles',\r\n\t\t\t\t\t\tsubmitParam:{},\r\n\t\t\t\t\t\tgetPicParam:{}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tuploadType:{type:String,defalut:''},\t//是否上传头像\r\n\t\t\tuserImgPath:{type:String,defalut:''},\t//当前头像\r\n\t\t\tnewUserImgPath:{type:String,defalut:''}\t\t//上传之后预览的头像\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttailSpin:tailSpin,\r\n\t\t\t\tpicsArray: [],\r\n\t\t\t\trealArray:{},\r\n\t\t\t\tchooseNumber:0,//选择的图片\r\n\t\t\t\tuploadumber:0,//已经上传的图片\r\n\t\t\t\tnewUpload:[]//上传成功的图片\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState([\"baseUrl\",\"defaultUrl\",\"token\"]),\r\n\t\t\tpicNum(){\r\n\t\t\t\treturn this.element.elementFormat !== 2 ? this.uploadNum : 1\r\n\t\t\t},\r\n\t\t\tnoUploadNumber(){\r\n\t\t\t\treturn this.chooseNumber - this.uploadumber\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tdelImg(picIndex){//删除\r\n\t\t\t\tconst _this = this\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle:_this.$i18nMsg(\"lang-form-modalTips\"),\r\n\t\t\t\t\tcontent:_this.$i18nMsg(\"lang-form-modalDel\"),\r\n\t\t\t\t\tsuccess: function (res) {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tconst pic = _this.picsArray[picIndex]\r\n\t\t\t\t\t\t\tdImageView(_this, {\r\n\t\t\t\t\t\t\t\timage:pic,\r\n\t\t\t\t\t\t\t\tpicIndex:picIndex\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpreviewImgs(e) {//预览\r\n\t\t\t\tlet prevImgArr = [];\r\n\t\t\t\tfor (let i = 0, len = this.picsArray.length; i < len; i++) {\r\n\t\t\t\t\tconst url = this.picsArray[i].url\r\n\t\t\t\t\tprevImgArr.push(url);\r\n\t\t\t\t}\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent: e.currentTarget.dataset.src,\r\n\t\t\t\t\turls: prevImgArr\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tchooseImags() {//选择图片\r\n\t\t\t\tif(this.picNum !== -1 && this.picsArray.length>=this.picNum) {\r\n\t\t\t\t\tthis.Static_GlobalFucs.showToast({\r\n\t\t\t\t\t\ttitle:`图片最多可以选择${this.picNum}`\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tlet residuePics = this.picNum - this.picsArray.length\r\n\t\t\t\tif(this.picNum === -1) residuePics = 9\r\n\t\t\t\tlet choosePics = residuePics > 9 ? 9 : residuePics,\r\n\t\t\t\t\t  _this = this\r\n\t\t\t\tif(this.uploadType == \"touxiang\"){\t\t//头像上传图片数量默认为1\r\n\t\t\t\t\tchoosePics = 1;\r\n\t\t\t\t}\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount:choosePics,\r\n\t\t\t\t\tsizeType:[\"compressed\"],\r\n\t\t\t\t\tsourceType: ['album', 'camera'], \r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t_this.chooseNumber += res.tempFilePaths.length\r\n\t\t\t\t\t\tUPLOAD_URLTOBASE64(res.tempFilePaths).then( (value) => {\r\n\t\t\t\t\t\t\tconst base64Array = value.base64Array,\r\n\t\t\t\t\t\t\t\t  orientationArray = value.orientationArray\r\n\t\t\t\t\t\t\tconst picsBase64 = [],\r\n\t\t\t\t\t\t\t\t  filePath = []\r\n\t\t\t\t\t\t\tfor(let i = 0;i<base64Array.length;i++){\r\n\t\t\t\t\t\t\t\t// _this.picsArray.push(\"firstCanvas0\")\r\n\t\t\t\t\t\t\t\tconst orientation = orientationArray[i]\r\n\t\t\t\t\t\t\t\tlet basr64 =base64Array[i]\r\n\t\t\t\t\t\t\t\tif([2,3,4,5,6,7,8].indexOf(orientation) !== -1){\r\n\t\t\t\t\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\t\t\t\t\tresetOrientation(basr64,orientation,function(newbase){\r\n\t\t\t\t\t\t\t\t\t\t_this.showAndUploadPic(newbase,[],1)\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tpicsBase64.push(basr64)\r\n\t\t\t\t\t\t\t\t\tfilePath.push(res.tempFiles[i])\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t_this.showAndUploadPic(picsBase64,filePath)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\t\r\n\t\t\t},\r\n\t\t\tshowAndUploadPic(showBase64,uploadpics,type=0){//type是否有处理过旋转\r\n\t\t\t\tif(type){//旋转过的图片上传\r\n\t\t\t\t\tlet authType = 1\r\n\t\t\t\t\tif(this.element.elementFormat === 2) authType = 2 //2-不需要返回token\r\n\t\t\t\t\tuploadPiOrientationc({\r\n\t\t\t\t\t\tshowBase64:showBase64,\r\n\t\t\t\t\t\totherParam:this.requestConfig.submitParam,\r\n\t\t\t\t\t\tauthType:authType\r\n\t\t\t\t\t},this)\r\n\t\t\t\t}else{//未旋转过的图片\r\n\t\t\t\t\tlet submitUrl = this.baseUrl || this.defaultUrl;\r\n\t\t\t\t\tif(process.env.NODE_ENV === 'development'){ //在开发情况下\r\n\t\t\t\t\t\t// #ifdef H5  \r\n\t\t\t\t\t\tsubmitUrl = \"/eam/\"\r\n\t\t\t\t\t\t// #endif \r\n\t\t\t\t\t}\r\n\t\t\t\t\tuploadPic({\r\n\t\t\t\t\t\tsubmitUrl:submitUrl + this.requestConfig.submitUrl,\r\n\t\t\t\t\t\timages:uploadpics,\r\n\t\t\t\t\t\tshowBase64:showBase64,\r\n\t\t\t\t\t\ttoken:this.token,\r\n\t\t\t\t\t\totherParam:this.requestConfig.submitParam\r\n\t\t\t\t\t},this)\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}, \r\n\t\t\tgetImages(){//获取图片\r\n\t\t\t\t//如果关联id为空不请求数据\r\n\t\t\t\tif(!this.requestConfig.getPicParam.relationId) return\r\n\t\t\t\tfileApi.getRelationFile(this.requestConfig.getPicParam)\r\n\t\t\t\t.then(pics => {\r\n\t\t\t\t\tthis.picsArray = pics || []\r\n\t\t\t\t\tthis.$emit('allImgs', {...this.imageConfig.allImgsParam,...{value:pics}});\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tif(this.element.elementFormat !== 2){\r\n\t\t\t\tthis.getImages()\r\n\t\t\t}else if(this.base64Url){\r\n\t\t\t\tlet urlAry = this.base64Url.split(\"_\") //保存到表的url前面默认会加上图片id，便于后续删除\r\n\t\t\t\tlet id = -1, url = \"\"\r\n\t\t\t\tif(urlAry.length>1){\r\n\t\t\t\t\tid = urlAry[0]\r\n\t\t\t\t\turl = urlAry[1]\r\n\t\t\t\t}else url = urlAry[0]\r\n\t\t\t\tthis.picsArray.push({\r\n\t\t\t\t\tid:id,\r\n\t\t\t\t\turl:url\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//删除文件\r\n\tconst dImageView = async (_this, param) =>{//删除节点\r\n\t\t// if(_this.element.elementFormat === 2){//如果为base64\r\n\t\t// \t_this.picsArray = []\r\n\t\t// \t_this.$emit('allImgs', {..._this.imageConfig.allImgsParam,...{value:[]}});\r\n\t\t// \treturn \r\n\t\t// }\r\n\t\t\r\n\t\tconst imag = param.image//图片信息\r\n\t\tif(imag.relationId) {//如果存在业务id需要删除业务关系\r\n\t\t\tawait fileApi.filesRelationDel(imag.id).then(value => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon:'none',\r\n\t\t\t\t\ttitle:'操作成功'\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\t//没有业务关系时分图片是否已经上传至文件服务器\r\n\t\t\tif(imag.id !== -1){\r\n\t\t\t\tlet params = []\r\n\t\t\t\tparams.push({id:imag.id})\r\n\t\t\t\tawait fileApi.fileDelete(params).then(value => {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ticon:'none',\r\n\t\t\t\t\t\ttitle:'操作成功'\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t_this.$emit('onImgDel', imag.id)\r\n\t\t\t}\r\n\t\t\tlet value = ''\r\n\t\t\tif(_this.element.elementFormat !== 2) value = _this.picsArray\r\n\t\t\t_this.$emit('allImgs', {..._this.imageConfig.allImgsParam,...{value:value}});\r\n\t\t}\r\n\t\t_this.picsArray.splice(param.picIndex, 1);\r\n\t}\r\n\t//保存图片\r\n\tconst uploadImage = (res,showBase64,index,_this) => {//上传成功\r\n\t\tlet showPics = []\r\n\t\tif(res.success){//上传成功\r\n\t\t\tlet uploadPics = res.data || []\r\n\t\t\t_this.uploadumber += uploadPics.length\r\n\t\t\tif(index === -1){\r\n\t\t\t\tfor(let i = 0;i<uploadPics.length;i++){\r\n\t\t\t\t\tshowPics.push({\r\n\t\t\t\t\t\tid:uploadPics[i].id,\r\n\t\t\t\t\t\tbase64:showBase64[i],\r\n\t\t\t\t\t\turl:uploadPics[i].url\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tshowPics.push({\r\n\t\t\t\t\tid:uploadPics[0].id,\r\n\t\t\t\t\tbase64:showBase64,\r\n\t\t\t\t\turl:uploadPics[0].url\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif(_this.element.elementFormat === 2){//base64\r\n\t\t\t\t_this.$emit('allImgs', {..._this.imageConfig.allImgsParam,...{value:uploadPics[0].url}});\r\n\t\t\t}else{\r\n\t\t\t\t_this.$emit('onUpImg', {\r\n\t\t\t\t\tuploadPics:uploadPics,\r\n\t\t\t\t\tgetPicParam:_this.requestConfig.getPicParam\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}else {\r\n\t\t\t_this.$emit('onUpImgError', res.data);\r\n\t\t}\r\n\t\treturn showPics\r\n\t}\r\n\tasync function uploadPiOrientationc(param,_this){\r\n\t\tlet showBase64 = param.showBase64\r\n\t\tlet submitParam = {\r\n\t\t\tdisplayFileName:new Date().getTime() + '.jpg',\r\n\t\t\timgByte:showBase64,\r\n\t\t\tauthType:param.authType || 1\r\n\t\t}\r\n\t\tawait fileApi.fileUploadBase64({...submitParam, ...param.otherParam}).then( value => {\r\n\t\t\tlet showPic = uploadImage(value,showBase64,0,_this)\r\n\t\t\t_this.picsArray = _this.picsArray.concat(showPic)\r\n\t\t\tif(_this.element.elementFormat !== 2){\r\n\t\t\t\t_this.$emit('allImgs', {..._this.imageConfig.allImgsParam,...{value:_this.picsArray}});\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n\tasync function uploadOneByOne(param , _this) {//一张一张上传\r\n\t\t// #ifndef H5\r\n\t\tlet pics = param.images\r\n\t\tfor(let k = 0,len = pics.length; k < len; k++ ){\r\n\t\t\tlet file = pics[k]\r\n\t\t\tawait uni.uploadFile({//开始上传\r\n\t\t\t\turl: param.submitUrl,\r\n\t\t\t\theader: {\r\n\t\t\t\t\t'token':param.token\r\n\t\t\t\t},\r\n\t\t\t\tfilePath:file.path,\r\n\t\t\t\tname:'file',\r\n\t\t\t\tformData: param.otherParam,\r\n\t\t\t\tsuccess(res) {\r\n\t\t\t\t\tif (res.statusCode == 200) {\r\n\t\t\t\t\t\tlet result = JSON.parse(res.data);\r\n\t\t\t\t\t\tlet showPic = param.showBase64[k]\r\n\t\t\t\t\t\tshowPic = uploadImage(result,showPic,k,_this)\r\n\t\t\t\t\t\t_this.picsArray = _this.picsArray.concat(showPic)\r\n\t\t\t\t\t\tif(_this.element.elementFormat !== 2){\r\n\t\t\t\t\t\t\t_this.$emit('allImgs', {..._this.imageConfig.allImgsParam,...{value:_this.picsArray}});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail(err) {\r\n\t\t\t\t\tconsole.warn(err, '请检查是否CORB/CORS错误!')\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\t// #endif\r\n\t\t// #ifdef H5\r\n\t\t//H5环境下先转base64再上传\r\n\t\tlet pics = param.showBase64\r\n\t\tfor(let k = 0,len = pics.length; k < len; k++ ){\r\n\t\t\tlet file = pics[k]\r\n\t\t\tawait uni.uploadFile({//开始上传\r\n\t\t\t\turl: param.submitUrl,\r\n\t\t\t\theader: {\r\n\t\t\t\t\t'token':param.token\r\n\t\t\t\t},\r\n\t\t\t\tfilePath:file,\r\n\t\t\t\tname:'file',\r\n\t\t\t\tformData: param.otherParam,\r\n\t\t\t\tsuccess(res) {\r\n\t\t\t\t\tif (res.statusCode == 200) {\r\n\t\t\t\t\t\tlet result = JSON.parse(res.data);\r\n\t\t\t\t\t\tlet showPic = param.showBase64[k]\r\n\t\t\t\t\t\tshowPic = uploadImage(result,showPic,k,_this)\r\n\t\t\t\t\t\t_this.picsArray = _this.picsArray.concat(showPic)\r\n\t\t\t\t\t\tif(_this.element.elementFormat !== 2){\r\n\t\t\t\t\t\t\t_this.$emit('allImgs', {..._this.imageConfig.allImgsParam,...{value:_this.picsArray}});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail(err) {\r\n\t\t\t\t\tconsole.warn(err, '请检查是否CORB/CORS错误!')\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\t// #endif\r\n\t}\r\n\tasync function uploadPic(param,_this){\r\n\t\t// #ifdef APP-PLUS\r\n\t\t//app批量上传\r\n\t\tif(_this.element.elementFormat === 2){//如果为base64\r\n\t\t\tuploadOneByOne(param, _this)\r\n\t\t\treturn \r\n\t\t}\r\n\t\tlet imgs = param.images.map((value, index) => {//转化可上传数据\r\n\t\t    return {\r\n\t\t        name: \"files\"+index, \r\n\t\t        uri: value.path\r\n\t\t    }\r\n\t\t})\r\n\t\tawait uni.uploadFile({//开始上传\r\n\t\t\turl: param.submitUrl,\r\n\t\t\theader: {\r\n\t\t\t\t'content-type': 'multipart/form-data',\r\n\t\t\t\t'token':param.token\r\n\t\t\t},\r\n\t\t\tfiles:imgs,\r\n\t\t\tformData: param.otherParam,\r\n\t\t\tasync success(res) {\r\n\t\t\t\tif (res.statusCode == 200) {\r\n\t\t\t\t\tlet result = JSON.parse(res.data);\r\n\t\t\t\t\tconst showPics = uploadImage(result,param.showBase64,-1,_this)\r\n\t\t\t\t\t_this.picsArray = _this.picsArray.concat(showPics)\r\n\t\t\t\t\t_this.$emit('allImgs', {..._this.imageConfig.allImgsParam,...{value:_this.picsArray}});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync fail(err) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: `上传失败!`\r\n\t\t\t\t});\r\n\t\t\t\tconsole.warn(err, '请检查是否CORB/CORS错误!')\r\n\t\t\t}\r\n\t\t})\r\n\t\t// #endif\r\n\t\t\r\n\t\t// #ifndef APP-PLUS\r\n\t\t//h5一张一张上传\r\n\t\tuploadOneByOne(param, _this)\r\n\t\t// #endif\r\n\t}\r\n\t// 将图片旋转到正确的角度\r\n\tfunction resetOrientation(srcBase64, srcOrientation, callback) {\r\n\t    var img = new Image();\r\n\t\tconst arr = srcBase64.split(',')\r\n\t\tconst mime = arr[0].match(/:(.*?);/)[1] \r\n\t    img.onload = function() {\r\n\t        var width = img.width,\r\n\t            height = img.height,\r\n\t            canvas = document.createElement('canvas'),\r\n\t            ctx = canvas.getContext(\"2d\");\r\n\t        // set proper canvas dimensions before transform & export\r\n\t        if ([5,6,7,8].indexOf(srcOrientation) > -1) {\r\n\t            canvas.width = height;\r\n\t            canvas.height = width;\r\n\t        } else {\r\n\t            canvas.width = width;\r\n\t            canvas.height = height;\r\n\t        }\r\n\t        // transform context before drawing image\r\n\t        // -2: not jpeg\r\n\t        // -1: not defined\r\n\t        switch (srcOrientation) {\r\n\t            case 2: ctx.transform(-1, 0, 0, 1, width, 0); break;\r\n\t            case 3: ctx.transform(-1, 0, 0, -1, width, height ); break;\r\n\t            case 4: ctx.transform(1, 0, 0, -1, 0, height ); break;\r\n\t            case 5: ctx.transform(0, 1, 1, 0, 0, 0); break;\r\n\t            case 6: ctx.transform(0, 1, -1, 0, height , 0); break;\r\n\t            case 7: ctx.transform(0, -1, -1, 0, height , width); break;\r\n\t            case 8: ctx.transform(0, -1, 1, 0, 0, width); break;\r\n\t            default: ctx.transform(1, 0, 0, 1, 0, 0);\r\n\t        }\r\n\t        // draw image\r\n\t        ctx.drawImage(img, 0, 0);\r\n\t        // export base64，然后用画布旋转正确后再生成正确的base64\r\n\t        callback(canvas.toDataURL('image/jpeg'));\r\n\t    };\r\n\t    img.src = srcBase64;\r\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\r\n\t.del-image{\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tright: 0;\r\n\t\twidth:40upx;\r\n\t\theight:40upx;\r\n\t\tborder-radius: 50%;\r\n\t\tcolor: #fff;\r\n\t\tbackground:rgba(0,0,0,0.6);\r\n\t}\r\n\t/* 宽度 */\r\n\t.sunsin_width {\r\n\t\twidth: 150upx !important;\r\n\t\theight: 150upx !important;\r\n\t}\r\n\r\n\t/* 循环列表样式 */\r\n\t.sunsin_picture_list {\r\n\t\twidth: 96%;\r\n\t\tpadding: 2% 0;\r\n\t\tdisplay: flex;\r\n\t\t/* flex-wrap: wrap; */\r\n\t\ttext-align: center;\r\n\t}\r\n\t.sunsin_picture_list image {\r\n\t\twidth: 40upx;\r\n\t\theight: 40upx;\r\n\t\tmargin: 0 4%;\r\n\t}\r\n\t.sunsin_picture_list image.icon_replace {\r\n\t\twidth: 150upx;\r\n\t\theight: 150upx;\r\n\t}\r\n\r\n\t/* 添加图片样式 */\r\n\t.sunsin_add_image {\r\n\t\tcolor: #ddd;\r\n\t\tfont-size:24upx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 0 !important;\r\n\t\tcursor: pointer;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tflex-wrap: wrap;\r\n\t\tborder:1px dashed rgba(217,217,217,1);\r\n\t\tbackground-repeat: no-repeat;\r\n\t\tbackground-position: center;\r\n\t\tbackground-size: 60%;\r\n\t\tbackground-image: url(../../static/images/upload.png);\r\n\t}\r\n\r\n\t/* 预览图片 */\r\n\t.sunsin_picture_item {\r\n\t\tposition: relative;\r\n\t\tmargin-right: 30upx;\r\n\t}\r\n\r\n\t/* 删除按钮样式 */\r\n\t.sunsin_picture_item .del {\r\n\t\tposition: absolute;\r\n\t\tcolor: #fff;\r\n\t\tborder-radius: -4upx;\r\n\t\tborder-top-right-radius: 6upx;\r\n\t\twidth: 40upx;\r\n\t\theight: 40upx;\r\n\t\tline-height: 40upx;\r\n\t\tz-index: 2;\r\n\t\ttext-align: center;\r\n\t\tbackground-color: #808080;\r\n\t\tborder-radius: 50%;\r\n\t}\r\n\r\n\t/* 删除图标位置(上左) */\r\n\t.sunsin_picture_item .del.left {\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tmargin-left: 4%;\r\n\t\tborder-top-right-radius: 0;\r\n\t\tborder-top-left-radius: 6upx;\r\n\t}\r\n\r\n\t/* 删除图标位置(上右) */\r\n\t.sunsin_picture_item .del.right {\r\n\t\ttop: 0;\r\n\t\tright: -4.2%;\r\n\t}\r\n\r\n\t/* 删除图标位置(下左) */\r\n\t.sunsin_picture_item .del.bleft {\r\n\t\tbottom: 0;\r\n\t\tleft: 4%;\r\n\t\tborder-top-left-radius: 0;\r\n\t\tborder-bottom-left-radius: 6upx;\r\n\t}\r\n\r\n\t/* 删除图标位置(下右) */\r\n\t.sunsin_picture_item .del.bright {\r\n\t\tright: -4.2%;\r\n\t\tbottom: 0;\r\n\t\tborder-top-right-radius: 0;\r\n\t}\r\n\r\n\t/* 进度遮罩层样式 */\r\n\t.sunsin_upload_progress {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 24upx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 160upx;\r\n\t\tmargin-left: 4%;\r\n\t\tborder-radius: 8upx;\r\n\t\tbackground-color: rgba(0, 0, 0, .7);\r\n\t}\r\n\r\n\t/* 自定义添加图片样式 */\r\n\t.sunsin_picture_item image {\r\n\t\tbox-shadow: 6upx 6upx 12upx rgba(112, 128, 144, 0.7);\r\n\t\tborder-radius: 15upx;\r\n\t}\r\n</style>\n","import mod from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./MniUpload.vue?vue&type=style&index=0&id=4103c6f8&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./MniUpload.vue?vue&type=style&index=0&id=4103c6f8&lang=scss&scoped=true&\""],"sourceRoot":""}