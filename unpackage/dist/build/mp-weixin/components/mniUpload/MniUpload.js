(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/mniUpload/MniUpload"],{"0b04":function(e,t,r){"use strict";r.r(t);var n=r("f836"),a=r("3755");for(var i in a)"default"!==i&&function(e){r.d(t,e,(function(){return a[e]}))}(i);r("60d4");var s,u=r("f0c5"),o=Object(u["a"])(a["default"],n["b"],n["c"],!1,null,"fc2c14f6",null,!1,n["a"],s);t["default"]=o.exports},3755:function(e,t,r){"use strict";r.r(t);var n=r("8536"),a=r.n(n);for(var i in n)"default"!==i&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},"60d4":function(e,t,r){"use strict";var n=r("b242"),a=r.n(n);a.a},8536:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r("4795")),a=r("f4db"),i=r("5c9e"),s=r("2f62"),u=o(r("88ef"));function o(e){return e&&e.__esModule?e:{default:e}}function l(e,t,r,n,a,i,s){try{var u=e[i](s),o=u.value}catch(l){return void r(l)}u.done?t(o):Promise.resolve(o).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function s(e){l(i,n,a,s,u,"next",e)}function u(e){l(i,n,a,s,u,"throw",e)}s(void 0)}))}}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var h={name:"MniUpload",props:{element:{type:Object,defalut:function(){return{}}},base64Url:{type:String,defalut:""},relationName:{type:String,defalut:""},uploadNum:{type:Number,defalut:-1},imageConfig:{type:Object,defalut:function(){return{allImgsParam:{},element:{}}}},requestConfig:{type:Object,defalut:function(){return{submitUrl:"file/uploadFiles",submitParam:{},getPicParam:{}}}},uploadType:{type:String,defalut:""},userImgPath:{type:String,defalut:""},newUserImgPath:{type:String,defalut:""}},data:function(){return{tailSpin:u.default,picsArray:[],realArray:{},chooseNumber:0,uploadumber:0,newUpload:[]}},computed:p({},(0,s.mapState)(["baseUrl","defaultUrl","token"]),{picNum:function(){return 2!==this.element.elementFormat?this.uploadNum:1},noUploadNumber:function(){return this.chooseNumber-this.uploadumber}}),methods:{delImg:function(t){var r=this;e.showModal({title:r.$i18nMsg("lang-form-modalTips"),content:r.$i18nMsg("lang-form-modalDel"),success:function(e){if(e.confirm){var n=r.picsArray[t];d(r,{image:n,picIndex:t})}}})},previewImgs:function(t){for(var r=[],n=0,a=this.picsArray.length;n<a;n++){var i=this.picsArray[n].url;r.push(i)}e.previewImage({current:t.currentTarget.dataset.src,urls:r})},chooseImags:function(){if(-1!==this.picNum&&this.picsArray.length>=this.picNum)this.Static_GlobalFucs.showToast({title:"图片最多可以选择".concat(this.picNum)});else{var t=this.picNum-this.picsArray.length;-1===this.picNum&&(t=9);var r=t>9?9:t,n=this;"touxiang"==this.uploadType&&(r=1),e.chooseImage({count:r,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){n.chooseNumber+=e.tempFilePaths.length,(0,i.UPLOAD_URLTOBASE64)(e.tempFilePaths).then((function(t){for(var r=t.base64Array,a=t.orientationArray,i=[],s=[],u=0;u<r.length;u++){var o=a[u],l=r[u];-1!==[2,3,4,5,6,7,8].indexOf(o)||(i.push(l),s.push(e.tempFiles[u]))}n.showAndUploadPic(i,s)}))}})}},showAndUploadPic:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r){var n=1;2===this.element.elementFormat&&(n=2),b({showBase64:e,otherParam:this.requestConfig.submitParam,authType:n},this)}else{var a=this.baseUrl||this.defaultUrl;0,w({submitUrl:a+this.requestConfig.submitUrl,images:t,showBase64:e,token:this.token,otherParam:this.requestConfig.submitParam},this)}},getImages:function(){var e=this;this.requestConfig.getPicParam.relationId&&a.fileApi.getRelationFile(this.requestConfig.getPicParam).then((function(t){e.picsArray=t||[],e.$emit("allImgs",p({},e.imageConfig.allImgsParam,{},{value:t}))}))}},created:function(){if(2!==this.element.elementFormat)this.getImages();else if(this.base64Url){var e=this.base64Url.split("_"),t=-1,r="";e.length>1?(t=e[0],r=e[1]):r=e[0],this.picsArray.push({id:t,url:r})}}};t.default=h;var d=function(){var t=c(n.default.mark((function t(r,i){var s,u,o;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=i.image,!s.relationId){t.next=6;break}return t.next=4,a.fileApi.filesRelationDel(s.id).then((function(t){e.showToast({icon:"none",title:"操作成功"})}));case 4:t.next=15;break;case 6:if(-1===s.id){t.next=12;break}return u=[],u.push({id:s.id}),t.next=11,a.fileApi.fileDelete(u).then((function(t){e.showToast({icon:"none",title:"操作成功"})}));case 11:r.$emit("onImgDel",s.id);case 12:o="",2!==r.element.elementFormat&&(o=r.picsArray),r.$emit("allImgs",p({},r.imageConfig.allImgsParam,{},{value:o}));case 15:r.picsArray.splice(i.picIndex,1);case 16:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),g=function(e,t,r,n){var a=[];if(e.success){var i=e.data||[];if(n.uploadumber+=i.length,-1===r)for(var s=0;s<i.length;s++)a.push({id:i[s].id,base64:t[s],url:i[s].url});else a.push({id:i[0].id,base64:t,url:i[0].url});2===n.element.elementFormat?n.$emit("allImgs",p({},n.imageConfig.allImgsParam,{},{value:i[0].url})):n.$emit("onUpImg",{uploadPics:i,getPicParam:n.requestConfig.getPicParam})}else n.$emit("onUpImgError",e.data);return a};function b(e,t){return v.apply(this,arguments)}function v(){return v=c(n.default.mark((function e(t,r){var i,s;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.showBase64,s={displayFileName:(new Date).getTime()+".jpg",imgByte:i,authType:t.authType||1},e.next=4,a.fileApi.fileUploadBase64(p({},s,{},t.otherParam)).then((function(e){var t=g(e,i,0,r);r.picsArray=r.picsArray.concat(t),2!==r.element.elementFormat&&r.$emit("allImgs",p({},r.imageConfig.allImgsParam,{},{value:r.picsArray}))}));case 4:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function y(e,t){return P.apply(this,arguments)}function P(){return P=c(n.default.mark((function t(r,a){var i,s,u,o;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=r.images,s=n.default.mark((function t(s,u){var o;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=i[s],t.next=3,e.uploadFile({url:r.submitUrl,header:{token:r.token},filePath:o.path,name:"file",formData:r.otherParam,success:function(e){if(200==e.statusCode){var t=JSON.parse(e.data),n=r.showBase64[s];n=g(t,n,s,a),a.picsArray=a.picsArray.concat(n),2!==a.element.elementFormat&&a.$emit("allImgs",p({},a.imageConfig.allImgsParam,{},{value:a.picsArray}))}},fail:function(e){console.warn(e,"请检查是否CORB/CORS错误!")}});case 3:case"end":return t.stop()}}),t)})),u=0,o=i.length;case 3:if(!(u<o)){t.next=8;break}return t.delegateYield(s(u,o),"t0",5);case 5:u++,t.next=3;break;case 8:case"end":return t.stop()}}),t)}))),P.apply(this,arguments)}function w(e,t){return O.apply(this,arguments)}function O(){return O=c(n.default.mark((function e(t,r){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:y(t,r);case 1:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}}).call(this,r("543d")["default"])},b242:function(e,t,r){},f836:function(e,t,r){"use strict";var n,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return n}))}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/mniUpload/MniUpload-create-component',
    {
        'components/mniUpload/MniUpload-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("0b04"))
        })
    },
    [['components/mniUpload/MniUpload-create-component']]
]);
